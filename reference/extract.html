<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create geographical extracts from an OSM file — extract • rosmium</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create geographical extracts from an OSM file — extract"><meta property="og:description" content="Creates geographical extracts from an OSM data file or an OSM history file.
The geographical extent can be given either as a bounding box or as a
(multi)polygon."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rosmium</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/rosmium.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ipeaGIT/rosmium/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create geographical extracts from an OSM file</h1>
    <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/rosmium/blob/HEAD/R/extract.R" class="external-link"><code>R/extract.R</code></a></small>
    <div class="hidden name"><code>extract.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates geographical extracts from an OSM data file or an OSM history file.
The geographical extent can be given either as a bounding box or as a
(multi)polygon.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extract</span><span class="op">(</span></span>
<span>  <span class="va">input_path</span>,</span>
<span>  <span class="va">extent</span>,</span>
<span>  <span class="va">output_path</span>,</span>
<span>  strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"complete_ways"</span>, <span class="st">"smart"</span>, <span class="st">"simple"</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  echo_cmd <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spinner <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>input_path</dt>
<dd><p>A string. The path to the OSM data/history file whose
extent should be extracted from. Please see <a href="file_formats.html">file_formats</a> for a list of
supported file formats.</p></dd>


<dt>extent</dt>
<dd><p>Either a <code>POLYGON</code> or a <code>MULTIPOLYGON</code> <code>sf</code> object with only
one feature or a <code>bbox</code> object, created by <a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">sf::st_bbox</a>.</p></dd>


<dt>output_path</dt>
<dd><p>A string. The path to the file where the output should be
written to. Please see <a href="file_formats.html">file_formats</a> for a list of supported file formats.</p></dd>


<dt>strategy</dt>
<dd><p>A string. The strategy to use when creating the extract.
Available strategies are <code>"complete_ways"</code>, <code>"smart"</code> and <code>"simple"</code>.
Defaults to <code>"complete_ways"</code>. Please see the "Strategies" section for a
description of each one of them.</p></dd>


<dt>overwrite</dt>
<dd><p>A logical. Whether existing files should be overwritten by
the output. Defaults to <code>FALSE</code>.</p></dd>


<dt>echo_cmd</dt>
<dd><p>A logical. Whether to print the Osmium command generated by
the function call to the screen. Defaults to <code>FALSE</code>.</p></dd>


<dt>echo</dt>
<dd><p>A logical. Whether to print the standard output and error
generated by the Osmium call to the screen. Defaults to <code>TRUE</code>.</p></dd>


<dt>spinner</dt>
<dd><p>A logical. Whether to show a reassuring spinner while the
Osmium call is being executed. Defaults to <code>TRUE</code>.</p></dd>


<dt>verbose</dt>
<dd><p>A logical. Whether to display detailed information on the
running command. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The normalized path to the output file.</p>
    </div>
    <div id="strategies">
    <h2>Strategies</h2>
    

<p>Different strategies can be used when creating extracts. Depending on the
strategy, different objects will end up in the extracts. The strategies
differ in how much memory they need and how often they need to read the input
file. The choice of strategy depends on how you want to use the generated
extracts and how much memory and time you have.</p><ul><li><p><code>"simple"</code> - runs in a single pass. The extract will contain all nodes
inside the region and all ways referencing those nodes, as well as all
relations referencing any nodes or ways already included. Ways crossing the
region boundary will not be reference-complete. Relations will not be
reference-complete. This strategy is fast, because it reads the input only
once, but the result is not enough for most use cases. This strategy will not
work for history files.</p></li>
<li><p><code>"complete_ways"</code> - runs in two passes. The extract will contain all nodes
inside the region and all ways referencing those nodes, as well as all nodes
referenced by those ways. The extract will also contain all relations
referenced by nodes inside the region or ways already included and,
recursively, their parent relations. The ways are reference-complete, but the
relations are not.</p></li>
<li><p><code>"smart"</code> - runs in three passes. The extract will contain all nodes inside
the region and all ways referencing those nodes, as well as all nodes
referenced by those ways. The extract will also contain all relations
referenced by nodes inside the region or ways already included and,
recursively, their parent relations. The extract will also contain all nodes
and ways (and the nodes they reference) referenced by relations tagged
"type=multipolygon" directly referencing any nodes in the region or ways
referencing nodes in the region. The ways are reference-complete, and all
multipolygon relations referencing nodes in the regions or ways that have
nodes in the region are reference-complete. Other relations are not
reference-complete.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">pbf_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cur.osm.pbf"</span>, package <span class="op">=</span> <span class="st">"rosmium"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">pbf_path</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 525406</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># buffering the pbf bounding box 4000 meters inward and using the result</span></span></span>
<span class="r-in"><span><span class="co"># extent to extract the osm data inside it. transforming the crs because</span></span></span>
<span class="r-in"><span><span class="co"># inward buffers only work with projected crs</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">pbf_path</span>, layer <span class="op">=</span> <span class="st">"lines"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bbox_polygon</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">smaller_bbox_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">bbox_polygon</span>, <span class="fl">5880</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="op">-</span><span class="fl">4000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">smaller_bbox_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">smaller_bbox_poly</span>, <span class="fl">4326</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">output_path</span> <span class="op">&lt;-</span> <span class="fu">extract</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">pbf_path</span>,</span></span>
<span class="r-in"><span>  <span class="va">smaller_bbox_poly</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".osm.pbf"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">output_path</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 42503</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daniel Herszenhut.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

