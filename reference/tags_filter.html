<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Filter objects matching specified keys/tags — tags_filter • rosmium</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter objects matching specified keys/tags — tags_filter"><meta name="description" content="Get objects matching at least one of the specified expressions from the input
and write them to the output. All objects matching the expressions will be
kept in the output, and objects referenced by them will also be added to the
output (unless omit_referenced = TRUE). Objects will be written out in the
order they are found in the input. Please note that the function will only
work correctly on history files if omit_referenced is TRUE, and it cannot
be used on change files."><meta property="og:description" content="Get objects matching at least one of the specified expressions from the input
and write them to the output. All objects matching the expressions will be
kept in the output, and objects referenced by them will also be added to the
output (unless omit_referenced = TRUE). Objects will be written out in the
order they are found in the input. Please note that the function will only
work correctly on history files if omit_referenced is TRUE, and it cannot
be used on change files."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rosmium</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/rosmium.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipeaGIT/rosmium/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filter objects matching specified keys/tags</h1>
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/rosmium/blob/HEAD/R/tags_filter.R" class="external-link"><code>R/tags_filter.R</code></a></small>
      <div class="d-none name"><code>tags_filter.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Get objects matching at least one of the specified expressions from the input
and write them to the output. All objects matching the expressions will be
kept in the output, and objects referenced by them will also be added to the
output (unless <code>omit_referenced = TRUE</code>). Objects will be written out in the
order they are found in the input. Please note that the function will only
work correctly on history files if <code>omit_referenced</code> is <code>TRUE</code>, and it cannot
be used on change files.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tags_filter</span><span class="op">(</span></span>
<span>  <span class="va">input_path</span>,</span>
<span>  <span class="va">filters</span>,</span>
<span>  <span class="va">output_path</span>,</span>
<span>  invert_match <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  omit_referenced <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  remove_tags <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  echo_cmd <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spinner <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-input-path">input_path<a class="anchor" aria-label="anchor" href="#arg-input-path"></a></dt>
<dd><p>A string. The path to the OSM data/history file to which
the filters should be applied. Please see <a href="file_formats.html">file_formats</a> for a list of
supported file formats.</p></dd>


<dt id="arg-filters">filters<a class="anchor" aria-label="anchor" href="#arg-filters"></a></dt>
<dd><p>A string. The filter expressions that should be applied to the
input file. Please see the "Filter expressions" section for a description
of the filter expression format.</p></dd>


<dt id="arg-output-path">output_path<a class="anchor" aria-label="anchor" href="#arg-output-path"></a></dt>
<dd><p>A string. The path to the file where the output should be
written to. Please see <a href="file_formats.html">file_formats</a> for a list of supported file formats.</p></dd>


<dt id="arg-invert-match">invert_match<a class="anchor" aria-label="anchor" href="#arg-invert-match"></a></dt>
<dd><p>A logical. Whether to invert the sense of matching - i.e.
to exclude objects with matching tags. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-omit-referenced">omit_referenced<a class="anchor" aria-label="anchor" href="#arg-omit-referenced"></a></dt>
<dd><p>A logical. Whether to omit the nodes referenced from
matching ways and members referenced from matching relations. Defaults to
<code>FALSE</code>.</p></dd>


<dt id="arg-remove-tags">remove_tags<a class="anchor" aria-label="anchor" href="#arg-remove-tags"></a></dt>
<dd><p>A logical. Whether to remove tags from objects that are
not matching the filter expression but are included to complete references
(nodes in ways and members of relations). Defaults to <code>FALSE</code>. Please note
that if an object is both matching the filter and used as a reference it
will keep its tags.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>A logical. Whether existing files should be overwritten by
the output. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-echo-cmd">echo_cmd<a class="anchor" aria-label="anchor" href="#arg-echo-cmd"></a></dt>
<dd><p>A logical. Whether to print the Osmium command generated by
the function call to the screen. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-echo">echo<a class="anchor" aria-label="anchor" href="#arg-echo"></a></dt>
<dd><p>A logical. Whether to print the standard output and error
generated by the Osmium call to the screen. Defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-spinner">spinner<a class="anchor" aria-label="anchor" href="#arg-spinner"></a></dt>
<dd><p>A logical. Whether to show a reassuring spinner while the
Osmium call is being executed. Defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical. Whether to display detailed information on the
running command. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>A logical. Whether to display a progress bar while running
the command. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The normalized path to the output file.</p>
    </div>
    <div class="section level2">
    <h2 id="filter-expressions">Filter expressions<a class="anchor" aria-label="anchor" href="#filter-expressions"></a></h2>


<p>A filter expression specifies a tag or tags that should be found in the data
and the type of object (node, way or relation) that should be matched.</p>
<p>The object type(s) comes first, then a slash (/) and then the rest of the
expression. Object types are specified as 'n' (for nodes), 'w' (for ways),
'r' (for relations) and 'a' (for areas - closed ways with 4 or more nodes and
relations with <code>type=multipolygon</code> or <code>type=boundary</code> tag). Any combination
of them can be used. If the object type is not specified, the expression
matches all object types.</p>
<p>Some examples:</p><ul><li><p><code>n/amenity</code> - matches all nodes with the key "amenity".</p></li>
<li><p><code>nw/highway</code> - matches all nodes or ways with the key "highway".</p></li>
<li><p><code>/note</code> - matches objects of any type with the key "note".</p></li>
<li><p><code>note</code> - matches objects of any type with the key "note".</p></li>
<li><p><code>w/highway=primary</code> - matches all ways with the key "highway" and value
"primary".</p></li>
<li><p><code>w/highway!=primary</code> - matches all ways with the key "highway" and a value
other than "primary".</p></li>
<li><p><code>r/type=multipolygon,boundary</code> - matches all relations with key "type" and
value "multipolygon" or "boundary".</p></li>
<li><p><code>w/name,name:de=Kastanienallee,Kastanienstrasse</code> - matches any way with a
"name" or "name:de" tag with the value "Kastanienallee" or
"Kastanienstrasse".</p></li>
<li><p><code>n/addr:*</code> - matches all nodes with any key starting with "addr:"</p></li>
<li><p><code>n/name=*Paris</code> - matches all nodes with a name that contains the word
"Paris".</p></li>
<li><p><code>a/building</code> - matches any closed ways with 4 or more nodes or relations
tagged "building". Relations must also have a tag "type=multipolygon" or
"type=boundary".</p></li>
</ul><p>If there is no equal sign ("=") in the expression, only keys are matched and
values can be anything. If there is an equal sign ("=") in the expression,
the key is to the left and the value to the right. An exclamation sign ("!")
before the equal sign means: a tag with that key, but not the value(s) to the
right of the equal sign. A leading or trailing asterisk ("*") can be used for
substring or prefix matching, respectively. Commas (",") can be used to
separate several keys or values.</p>
<p>All filter expressions are case-sensitive. There is no way to escape the
special characters such as "=", "<em>" and ",". You can not mix
comma-expressions and "</em>"-expressions.</p>
<p>The specified filter expressions are matched in the order they are given. To
achieve best performance, put expressions expected to match more often first.</p>
<p>Area matches (with leading "a/") do not check whether the matched object is a
valid (multi)polygon, they only check whether an object might possibly be
turned into a (multi)polygon. This is the case for all closed ways (where the
first and last node are the same) with 4 or more nodes and for all relations
that have an additional "type=multipolygon" or "type=boundary" tag.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">pbf_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cur.osm.pbf"</span>, package <span class="op">=</span> <span class="st">"rosmium"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get all amenity nodes</span></span></span>
<span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">tags_filter</span><span class="op">(</span><span class="va">pbf_path</span>, <span class="st">"n/amenity"</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".osm.pbf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - </span>
<span class="r-in"><span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">output</span>, layer <span class="op">=</span> <span class="st">"points"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">$</span><span class="va">other_tags</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "\"amenity\"=&gt;\"university\",\"wikidata\"=&gt;\"Q10278991\""                                                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "\"amenity\"=&gt;\"telephone\",\"operator\"=&gt;\"OI\",\"payment:telephone_cards\"=&gt;\"yes\""                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "\"amenity\"=&gt;\"kindergarten\""                                                                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "\"addr:housenumber\"=&gt;\"45\",\"addr:street\"=&gt;\"Rua Amintas de Barros\",\"amenity\"=&gt;\"restaurant\",\"cuisine\"=&gt;\"arab\""</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "\"addr:city\"=&gt;\"Curitiba\",\"addr:housenumber\"=&gt;\"1250\",\"addr:street\"=&gt;\"Rua 7 de Abril\",\"amenity\"=&gt;\"pub\""      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "\"amenity\"=&gt;\"taxi\""                                                                                                    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get all objects (nodes, ways or relations) with an addr:* tag</span></span></span>
<span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">tags_filter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">pbf_path</span>,</span></span>
<span class="r-in"><span>  <span class="st">"addr:*"</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".osm.pbf"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  omit_referenced <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - </span>
<span class="r-in"><span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">output</span>, layer <span class="op">=</span> <span class="st">"points"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">$</span><span class="va">other_tags</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "\"addr:city\"=&gt;\"Curitiba\",\"addr:housenumber\"=&gt;\"358\",\"addr:postcode\"=&gt;\"80510-190\",\"addr:street\"=&gt;\"Rua Mateus Leme\",\"addr:suburb\"=&gt;\"Centro Cívico\",\"brand\"=&gt;\"Ibis\",\"brand:wikidata\"=&gt;\"Q920166\",\"brand:wikipedia\"=&gt;\"en:Ibis (hotel)\",\"tourism\"=&gt;\"hotel\""</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"1975\",\"addr:street\"=&gt;\"Avenida Marechal Deodoro\""                                                                                                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"2085\",\"addr:street\"=&gt;\"Avenida Marechal Deodoro\""                                                                                                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"1976\",\"addr:street\"=&gt;\"Avenida Marechal Deodoro\""                                                                                                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"2086\",\"addr:street\"=&gt;\"Avenida Marechal Deodoro\""                                                                                                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"965\",\"addr:street\"=&gt;\"Rua José de Alencar\""                                                                                                                                                           </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get all nodes and ways with a highway tag and all relations tagged with</span></span></span>
<span class="r-in"><span><span class="co"># type=restriction plus all referenced objects</span></span></span>
<span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">tags_filter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">pbf_path</span>,</span></span>
<span class="r-in"><span>  <span class="st">"nw/highway r/type=restriction"</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".osm.pbf"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -\|/-\ </span>
<span class="r-in"><span><span class="va">ways</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">output</span>, layer <span class="op">=</span> <span class="st">"lines"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ways</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "service"  "service"  "service"  "service"  "tertiary" "tertiary"</span>
<span class="r-in"><span><span class="va">relations</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">output</span>, layer <span class="op">=</span> <span class="st">"other_relations"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">relations</span><span class="op">$</span><span class="va">other_tags</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "\"restriction\"=&gt;\"no_right_turn\"" "\"restriction\"=&gt;\"no_left_turn\"" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "\"restriction\"=&gt;\"no_right_turn\"" "\"restriction\"=&gt;\"no_right_turn\""</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "\"restriction\"=&gt;\"no_right_turn\"" "\"restriction\"=&gt;\"no_u_turn\""    </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Herszenhut.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

