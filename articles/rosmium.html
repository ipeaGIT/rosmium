<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to rosmium: R bindings for Osmium Tool • rosmium</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to rosmium: R bindings for Osmium Tool">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rosmium</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rosmium.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipeaGIT/rosmium/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to rosmium: R bindings for Osmium Tool</h1>


      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/rosmium/blob/HEAD/vignettes/rosmium.Rmd" class="external-link"><code>vignettes/rosmium.Rmd</code></a></small>
      <div class="d-none name"><code>rosmium.Rmd</code></div>
    </div>



<p><strong>rosmium</strong> is a package that allows one to use <a href="https://osmcode.org/osmium-tool/" class="external-link">Osmium Tool</a> from R. Osmium
is a multipurpose command line tool that enables one to manipulate and
analyze OpenStreetMap (OSM) files through several different commands.
Currently, the package does not aim to cover the entirety of Osmium’s
API, instead making available functions that wrap only a very limited
set of Osmium’s features. This vignette briefly overviews the package
with a few reproducible examples.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Before using <strong>rosmium</strong> please make sure that you have
it installed in your computer. You can download either the most stable
version from CRAN…</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rosmium"</span><span class="op">)</span></span></code></pre></div>
<p>…or the development version from GitHub.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ipeaGIT/rosmium"</span><span class="op">)</span></span></code></pre></div>
<p>Please note that <strong>rosmium</strong> requires Osmium to be
installed and added to the PATH environment variable of your local
system. For instructions on how to install Osmium, please check <a href="https://osmcode.org/osmium-tool/#download" class="external-link">its official
website</a>.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The package currently includes only three entrypoints to Osmium’s
API. To demonstrate them, we will use some sample data bundled with the
package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/rosmium/">rosmium</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cur_pbf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cur.osm.pbf"</span>, package <span class="op">=</span> <span class="st">"rosmium"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cur_pbf_lines</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">cur_pbf</span>, layer <span class="op">=</span> <span class="st">"lines"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cur_pbf_lines</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="rosmium_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<div class="section level4">
<h4 id="extract">
<code>extract()</code><a class="anchor" aria-label="anchor" href="#extract"></a>
</h4>
<p><code><a href="../reference/extract.html">extract()</a></code> creates geographical extracts from OSM files.
In its most basic form, the function takes the path to the OSM file
whose geographical extent should be extracted from, the extent, either
as a bounding box or as a (multi)polygon, and the path to the file where
the output should be written to. Additionally, the function can also
take the strategy to be used when creating the extract, which defaults
to <code>"complete_ways"</code>. Please check the function documentation
for details on the available strategies and their behavior.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># buffering the pbf bounding box 4000 meters inward and using the result</span></span>
<span><span class="co"># extent to extract the osm data inside it. transforming the crs because</span></span>
<span><span class="co"># inward buffers only work with projected crs</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">cur_pbf_lines</span><span class="op">)</span></span>
<span><span class="va">bbox_polygon</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">smaller_bbox_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">bbox_polygon</span>, <span class="fl">5880</span><span class="op">)</span>, <span class="op">-</span><span class="fl">4000</span><span class="op">)</span></span>
<span><span class="va">smaller_bbox_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">smaller_bbox_poly</span>, <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract.html">extract</a></span><span class="op">(</span></span>
<span>  <span class="va">cur_pbf</span>,</span>
<span>  <span class="va">smaller_bbox_poly</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".osm.pbf"</span><span class="op">)</span>,</span>
<span>  spinner <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">extracted_pbf_lines</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">output_path</span>, layer <span class="op">=</span> <span class="st">"lines"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">extracted_pbf_lines</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">smaller_bbox_poly</span>, color <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="rosmium_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="tags_filter">
<code>tags_filter()</code><a class="anchor" aria-label="anchor" href="#tags_filter"></a>
</h4>
<p><code><a href="../reference/tags_filter.html">tags_filter()</a></code> filters OSM files, keeping objects
matching at least one of the specified expressions from the input. In
its most basic form, the function takes the path to the OSM file to
which the filters should be applied, the filter expressions that should
be applied and the path to the file where the output should be written
to. Please check the function documentation for a description of the
filter expression format.</p>
<p>By default, not only the objects matching the expressions will be
kept in the output, but also the objects referenced by them. This
behavior can be changed with the <code>omit_referenced</code> parameter.
The function also includes the <code>invert_match</code> parameter, that
inverts the sense of matching (excluding objects that match the
filters), and the <code>remove_tags</code> parameter, used to remove
tags from objects that are referenced by objects matching the filters,
but which do not match the filter themselves. Both arguments default to
<code>FALSE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get all amenity nodes</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tags_filter.html">tags_filter</a></span><span class="op">(</span><span class="va">cur_pbf</span>, <span class="st">"n/amenity"</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".osm.pbf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">output</span>, layer <span class="op">=</span> <span class="st">"points"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">$</span><span class="va">other_tags</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "\"amenity\"=&gt;\"university\",\"wikidata\"=&gt;\"Q10278991\""                                                                  </span></span>
<span><span class="co">#&gt; [2] "\"amenity\"=&gt;\"telephone\",\"operator\"=&gt;\"OI\",\"payment:telephone_cards\"=&gt;\"yes\""                                     </span></span>
<span><span class="co">#&gt; [3] "\"amenity\"=&gt;\"kindergarten\""                                                                                            </span></span>
<span><span class="co">#&gt; [4] "\"addr:housenumber\"=&gt;\"45\",\"addr:street\"=&gt;\"Rua Amintas de Barros\",\"amenity\"=&gt;\"restaurant\",\"cuisine\"=&gt;\"arab\""</span></span>
<span><span class="co">#&gt; [5] "\"addr:city\"=&gt;\"Curitiba\",\"addr:housenumber\"=&gt;\"1250\",\"addr:street\"=&gt;\"Rua 7 de Abril\",\"amenity\"=&gt;\"pub\""      </span></span>
<span><span class="co">#&gt; [6] "\"amenity\"=&gt;\"taxi\""</span></span>
<span></span>
<span><span class="co"># get all objects (nodes, ways or relations) with an addr:* tag</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tags_filter.html">tags_filter</a></span><span class="op">(</span></span>
<span>  <span class="va">cur_pbf</span>,</span>
<span>  <span class="st">"addr:*"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".osm.pbf"</span><span class="op">)</span>,</span>
<span>  omit_referenced <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spinner <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">output</span>, layer <span class="op">=</span> <span class="st">"points"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">$</span><span class="va">other_tags</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "\"addr:city\"=&gt;\"Curitiba\",\"addr:housenumber\"=&gt;\"358\",\"addr:postcode\"=&gt;\"80510-190\",\"addr:street\"=&gt;\"Rua Mateus Leme\",\"addr:suburb\"=&gt;\"Centro Cívico\",\"brand\"=&gt;\"Ibis\",\"brand:wikidata\"=&gt;\"Q920166\",\"brand:wikipedia\"=&gt;\"en:Ibis (hotel)\",\"tourism\"=&gt;\"hotel\""</span></span>
<span><span class="co">#&gt; [2] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"1975\",\"addr:street\"=&gt;\"Avenida Marechal Deodoro\""                                                                                                                                                     </span></span>
<span><span class="co">#&gt; [3] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"2085\",\"addr:street\"=&gt;\"Avenida Marechal Deodoro\""                                                                                                                                                     </span></span>
<span><span class="co">#&gt; [4] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"1976\",\"addr:street\"=&gt;\"Avenida Marechal Deodoro\""                                                                                                                                                     </span></span>
<span><span class="co">#&gt; [5] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"2086\",\"addr:street\"=&gt;\"Avenida Marechal Deodoro\""                                                                                                                                                     </span></span>
<span><span class="co">#&gt; [6] "\"addr:city\"=&gt;\"Curitiba\",\"addr:country\"=&gt;\"BR\",\"addr:housenumber\"=&gt;\"965\",\"addr:street\"=&gt;\"Rua José de Alencar\""</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="show_content">
<code>show_content()</code><a class="anchor" aria-label="anchor" href="#show_content"></a>
</h4>
<p>Finally, <code><a href="../reference/show_content.html">show_content()</a></code> displays the content of an OSM
file either in <code>.html</code>, <code>.xml</code> or
<code>.opl</code> format. The function takes as input the path to the
OSM file whose content should be shown, the output format in which the
content should be displayed (defaulting to <code>.html</code>, the most
human readable format, although also the slowest to open and inspect,
depending on the size of the input file) and the type of objects that
should be included in the output (defaulting to all existing objects in
the input). The function returns the path to the temporary file in which
the OSM file content was saved and opens the content in the web browser
or the most appropriate application, depending on the output format.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># displays the content of the previous tags_filter() output in html format</span></span>
<span><span class="fu"><a href="../reference/show_content.html">show_content</a></span><span class="op">(</span><span class="va">output</span>, spinner <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpMNfsH0/osm_content4134390025ec.html"</span></span></code></pre></div>
<p><img src="../reference/figures/filtered_file_content.png" width="360"></p>
</div>
<div class="section level3">
<h3 id="acknowledgement">Acknowledgement<a class="anchor" aria-label="anchor" href="#acknowledgement"></a>
</h3>
<p><strong>rosmium</strong> is developed by a team at the Institute for
Applied Economic Research (Ipea), Brazil. We would like to thank the
authors and contributors of Osmium for the development of <a href="https://github.com/osmcode/osmium-tool" class="external-link">Osmium Tool</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Herszenhut.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
